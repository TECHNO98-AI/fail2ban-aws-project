name: Deploy Fail2Ban AWS Lambda

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  AWS_REGION: ${{ secrets.AWS_REGION }}
  DEPLOY_S3_BUCKET: ${{ secrets.DEPLOY_S3_BUCKET }}
  S3_BUCKET:  S3_BUCKET:  S3_BUCKET:UC  S3_BUCKET:  S3_BUCT  S3_BUCKET:  S3_BUCKET:  S3_BUjo  S3_BUCKET:  d-  S3_BUCKET:  S3_BUCKET:  S3_BUCKET:UC st  S3_BUCKET:  S3_BUCKET:  t r  S3_BUCKET:  S3_BUCKET:  S3_BUCKET:UC
                                                      p-                                                                    p-    ta                                                      p-            ka                                              ge
                                                                                   -e                                    ge                                                                                   -e                                    ge     ech                                                      ambda update-function-code \
              --function-name "${{ env.LAMBDA_FUNCTION_NAME }}" \
              --s3-bucket "${{ env.S3_BUCKET }}" \
              --s3-key "lambda/fail2ban-lambda.zip" \
              --region "${{ env.AWS_REGION }}"
          else
            echo "ðŸ†• Creating new Lambda..."
            aws lambda create-function \
              --function-name "${{ env.LAMBDA_FUNCTION_NAME }}" \
              --runtime python3.9 \
              --role "${{ secrets.LAMBDA_ROLE_ARN }}" \
              --handler fail2ban_lambda.lambda_handler \
              --code S3Bucket="${{ env.S3_BUCKET }}",S3Key="lambda/fail2ban-lambda.zip" \
              --timeout 30 \
              --memory-size 128 \
              --region "${{ env.AWS_REGION }}"
          fi
